create database universidad
create login tarea1 with password = '_Tarea1_'

use universidad
GO

create user tarea1 for login tarea1
exec sp_addrolemember 'db_datareader', 'tarea1'
exec sp_addrolemember 'db_datawriter', 'tarea1'

create table estudiante (
  id bigint IDENTITY(1,1) PRIMARY KEY NOT NULL,
  identificacion varchar(9) UNIQUE NOT NULL,
  nombre varchar(50) NOT NULL,
  primerApellido varchar(50) NOT NULL,
  segundoApellido varchar(50) NOT NULL,
  fechaNacimiento datetime NOT NULL,
  fechaIngreso datetime
)


create table escuela (
  id int IDENTITY(1,1) PRIMARY KEY NOT NULL,
  codigo varchar(5) UNIQUE NOT NULL,
  nombre varchar(100)
)

create table carrera (
  id int IDENTITY(1,1) PRIMARY KEY NOT NULL,
  codigo varchar(5) UNIQUE NOT NULL,
  idEscuela int NOT NULL FOREIGN KEY REFERENCES escuela(id),
  nombre varchar(100)
)

create table curso (
  id int IDENTITY(1,1) PRIMARY KEY NOT NULL,
  codigo varchar(5) UNIQUE NOT NULL,
  nombre varchar(100) NOT NULL,
  descripcion varchar(255),
  idCarrera int NOT NULL FOREIGN KEY REFERENCES carrera(id),
  precio money NOT NULL
)

create table matricula (
  id int IDENTITY(1,1) PRIMARY KEY NOT NULL,
  idEstudiante bigint FOREIGN KEY REFERENCES estudiante(id),
  fecha datetime NOT NULL
)

create table matricula_detalle (
  id int IDENTITY(1,1) PRIMARY KEY NOT NULL,
  idMatricula int FOREIGN KEY REFERENCES matricula(id),
  idCurso int FOREIGN KEY REFERENCES curso(id),
)

---

insert into estudiante values ('800910533', 'Alberto', 'Sierra', 'Reales', '1981-09-29 00:00:00', GETDATE())

insert into escuela values ('10', 'Ciencias de la Administración'),
  ('20', 'Ciencias de la Educación'),
  ('30', 'Ciencias Exactas y Naturales'),
  ('40', 'Ciencias Sociales y Humanidades')

insert into carrera values ('88', '30', 'Bachillerato en Ingeniería informática'),
  ('90', '30', 'Licenciatura en Desarrollo Web')

insert into curso values ('03101', 'Programación Avanzada en Web', 'Programación Web C#', '90', 1, 70000),
  ('00831', 'Programación I', 'Introducción a la Programación', '88', 1, 50000),
  ('00824', 'Programación II', 'Programación Intermedia', '88', 8, 50000),
  ('00826', 'Bases de Datos I', 'Bases de datos', '88', 1, 50000),
  ('03084', 'Bases de Datos II', 'Bases de datos', '90', 8, 70000)

insert into dbo.matricula values (3, GETDATE())

insert into dbo.matricula_detalle values (1, '03101'), (1, '00824')



-- lista de estudiantes matriculados por curso

select e.id
	,e.nombre
	,e.primerApellido
	,e.segundoApellido
from dbo.estudiante e 
	inner join matricula m on e.id = m.idEstudiante 
	inner join matricula_detalle d on m.id = d.idMatricula 
	inner join curso c on d.idCurso = c.codigo 
where m.estado  = 48
and m.periodo = '202203'
and c.codigo = '03101'



  